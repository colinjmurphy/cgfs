from cgfs.canvas import PillowCanvas


def test_put_pixel():
    canvas = PillowCanvas(3, 3)
    assert canvas._byte_array == bytearray([
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    ])

    canvas.put_pixel(4, (1, 2, 3))
    assert canvas._byte_array == bytearray([
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0xff, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    ])

    canvas.put_pixel(0, (4, 5, 6))
    assert canvas._byte_array == bytearray([
        0x04, 0x05, 0x06, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0xff, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    ])


def test_pixel_iterator():
    canvas = PillowCanvas(50, 50)
    pixel_values = list(canvas.pixel_iterator())
    assert pixel_values[0] == (-25, 24, 0)
    assert pixel_values[49] == (24, 24, 49)
    assert pixel_values[2450] == (-25, -25, 2450)
    assert pixel_values[2499] == (24, -25, 2499)

    canvas = PillowCanvas(51, 51)
    pixel_values = list(canvas.pixel_iterator())
    assert pixel_values[0] == (-25, 25, 0)
    assert pixel_values[50] == (25, 25, 50)
    assert pixel_values[2550] == (-25, -25, 2550)
    assert pixel_values[2600] == (25, -25, 2600)
